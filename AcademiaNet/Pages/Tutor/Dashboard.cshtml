@page
@model Academic.Pages.Tutor.DashboardModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-md-3 sidebar">
        <div class="card shadow-sm mb-3">
            <div class="card-body text-center">
                <h5 class="mb-0">Tutor</h5>
                <small class="text-muted">@Model.Tutor?.Nombre @Model.Tutor?.Apellido</small>
            </div>
            <div class="list-group list-group-flush">
                <a class="list-group-item list-group-item-action active" href="#">Resumen</a>
                <a class="list-group-item list-group-item-action" asp-page="/Tutor/Dashboard">Salones</a>
                <a class="list-group-item list-group-item-action" asp-page="/Public/Materials">Materiales</a>
            </div>
        </div>
    </div>

    <div class="col-md-9">
        <div class="card shadow-sm mb-3">
            <div class="card-body d-flex justify-content-between align-items-center">
                <h4 class="mb-0">Panel Tutor</h4>
                <div>
                    <a class="btn btn-primary" asp-page="/Tutor/Dashboard">Refrescar</a>
                </div>
            </div>
        </div>

        <div class="row g-3">
            @if (Model.Salones.Any())
            {
                foreach (var s in Model.Salones)
                {
                    <div class="col-md-6">
                        <div class="card shadow-sm h-100">
                            <div class="card-header bg-dark text-white">@s.Nombre <small class="text-muted">(@s.Sede?.Nombre)</small></div>
                            <div class="card-body">
                                <p><strong>Alumnos:</strong></p>
                                <ul>
                                    @foreach (var a in s.Alumnos ?? new List<Academic.Models.Alumno>())
                                    {
                                        <li>@a.Nombre @a.Apellido <small class="text-muted">@a.Email</small></li>
                                    }
                                </ul>

                                <p><strong>Horario:</strong></p>
                                <ul>
                                    @foreach (var h in s.Horarios ?? new List<Academic.Models.Horario>())
                                    {
                                        <li>@h.Dia - @h.HoraInicio.ToString(@"hh\:mm") - @h.HoraFin.ToString(@"hh\:mm")</li>
                                    }
                                </ul>

                                <p><strong>Materiales:</strong></p>
                                @if (s.Materiales != null && s.Materiales.Any())
                                {
                                    <ul>
                                        @foreach (var m in s.Materiales.OrderBy(m => m.Week))
                                        {
                                            <li>
                                                <strong>Semana @m.Week:</strong> @m.Title<br />
                                                <small class="text-muted">@m.Description</small>
                                            </li>
                                        }
                                    </ul>
                                }
                                else
                                {
                                    <p class="text-muted">No hay materiales para este salón.</p>
                                }

                                <form method="post" asp-page-handler="CreateMaterial" asp-route-salonId="@s.Id" class="mt-2">
                                    <div class="mb-2"><strong>Agregar material</strong></div>
                                    <div class="mb-2">
                                        <input asp-for="NewMaterialTitle" class="form-control" placeholder="Título" />
                                    </div>
                                    <div class="mb-2">
                                        <textarea asp-for="NewMaterialDescription" class="form-control" placeholder="Descripción"></textarea>
                                    </div>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <input asp-for="NewMaterialWeek" type="number" min="1" class="form-control" placeholder="Semana" />
                                        </div>
                                        <div class="col-6 text-end">
                                            <button class="btn btn-success">Crear material</button>
                                        </div>
                                    </div>
                                </form>

                                <form method="post" asp-page-handler="CreateStudent" asp-route-salonId="@s.Id" class="mt-3">
                                    <div class="row g-2">
                                        <div class="col-12 col-md-4">
                                            <input asp-for="NewStudentNombre" class="form-control" placeholder="Nombre" />
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <input asp-for="NewStudentApellido" class="form-control" placeholder="Apellido" />
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <input asp-for="NewStudentEmail" class="form-control" placeholder="Email" />
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <button class="btn btn-primary">Crear alumno</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-body">No tienes salones asignados.</div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<style>
    .card-header.bg-dark { background-color: #800020 !important; }
</style>